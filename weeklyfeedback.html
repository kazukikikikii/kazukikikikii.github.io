<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>性格診断アンケート</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #cac363;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            text-align: center;
            width: 80%;
            max-width: 600px;
        }
        .question {
            margin-bottom: 20px;
        }
        .question p {
            margin: 0;
        }
        .options {
            margin-left: 20px;
            text-align: left;
        }
        .submit-button {
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>性格診断アンケート</h1>
        <form id="surveyForm"></form>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const negativeQuestions = [
                { text: '考えすぎて眠れない日がある', name: 'q1' },
                { text: '体がだるく、疲れやすいことがある', name: 'q2' },
                { text: '気が沈んだり、気が重くなることがある', name: 'q3' },
                { text: '食事がすすまないことがある', name: 'q4' },
                { text: '何もしたくない日がある', name: 'q5' },
                { text: '勉強や部活が上手くいかない', name: 'q6' }
            ];

            const positiveQuestions = [
                { text: '音楽を聴いていて楽しい', name: 'q7' },
                { text: '朝が得意だ', name: 'q8' },
                { text: '会話をすることが好きだ', name: 'q9' },
                { text: '学校に行くことが好きだ', name: 'q10' },
                { text: '自分は幸せだと思う', name: 'q11' },
                { text: '打ち込める趣味がある', name: 'q12' }
            ];

            function getRandomQuestions(questions, num) {
                const shuffled = questions.sort(() => 0.5 - Math.random());
                return shuffled.slice(0, num);
            }

            const selectedNegativeQuestion = getRandomQuestions(negativeQuestions, 1);
            const selectedPositiveQuestions = getRandomQuestions(positiveQuestions, 2);
            const selectedQuestions = selectedNegativeQuestion.concat(selectedPositiveQuestions);
            const form = document.getElementById('surveyForm');

            selectedQuestions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.classList.add('question');
                
                const questionP = document.createElement('p');
                questionP.textContent = `${index + 1}. ${question.text}`;
                questionDiv.appendChild(questionP);

                const optionsDiv = document.createElement('div');
                optionsDiv.classList.add('options');

                const optionTexts = ['apply', 'somewhat apply', 'somewhat not apply', 'not apply'];
                const optionLabels = question.name.startsWith('q1') || question.name.startsWith('q2') || question.name.startsWith('q4') || question.name.startsWith('q8') || question.name.startsWith('q9') || question.name.startsWith('q11') 
                    : ['あてはまる', 'ややあてはまる', 'ややあてはまらない', 'あてはまらない'];

                optionTexts.forEach((value, idx) => {
                    const id = `${question.name}_${value}`;
                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.id = id;
                    input.name = question.name;
                    input.value = value;
                    input.required = true;
                    
                    const label = document.createElement('label');
                    label.setAttribute('for', id);
                    label.textContent = optionLabels[idx];
                    
                    optionsDiv.appendChild(input);
                    optionsDiv.appendChild(label);
                    optionsDiv.appendChild(document.createElement('br'));
                });

                questionDiv.appendChild(optionsDiv);
                form.appendChild(questionDiv);
            });

            const submitButtonDiv = document.createElement('div');
            submitButtonDiv.classList.add('submit-button');
            const submitButton = document.createElement('button');
            submitButton.type = 'submit';
            submitButton.textContent = 'データを送信する';
            submitButtonDiv.appendChild(submitButton);
            form.appendChild(submitButtonDiv);

            const pointValues = {
                'apply': 100,
                'somewhat apply': 75,
                'somewhat not apply': 50,
                'not apply': 25
            };

            const negativePointValues = {
                'apply': 25,
                'somewhat apply': 50,
                'somewhat not apply': 75,
                'not apply': 100
            };

            function saveResults(results) {
                let storedResults = JSON.parse(localStorage.getItem('surveyResults')) || [];
                storedResults.push(results);
                localStorage.setItem('surveyResults', JSON.stringify(storedResults));
            }

            form.addEventListener('submit', function(event) {
                event.preventDefault();

                const formData = new FormData(event.target);
                const results = {};
                for (let [name, value] of formData.entries()) {
                    if (negativeQuestions.some(q => q.name === name)) {
                        results[name] = negativePointValues[value];
                    } else {
                        results[name] = pointValues[value];
                    }
                }

                saveResults(results);
                window.location.href = 'weeklykekka.html';
            });
        });
    </script>
</body>
</html>
